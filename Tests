*Вывести имена всех когда-либо обслуживаемых пассажиров авиакомпаний*
SELECT name FROM Passenger

*Вывести названия всеx авиакомпаний*
SELECT name FROM Company

*Вывести все рейсы, совершенные из Москвы*
SELECT * FROM Trip WHERE town_from = 'Moscow'

*Вывести имена людей, которые заканчиваются на "man"*
SELECT name FROM Passenger WHERE name LIKE '%man'

*Вывести количество рейсов, совершенных на TU-134*
SELECT COUNT(plane) as count FROM Trip WHERE plane = 'TU-134' 

*Какие компании совершали перелеты на Boeing*
SELECT name FROM Company WHERE id in (SELECT DISTINCT company FROM Trip WHERE plane = 'Boeing')

*Вывести все названия самолётов, на которых можно улететь в Москву (Moscow)
SELECT DISTINCT  plane FROM Trip WHERE town_to = 'Moscow'*

*В какие города можно улететь из Парижа (Paris) и сколько времени это займёт?*
SELECT town_to, TIMEDIFF(time_in, time_out) as flight_time FROM Trip
WHERE town_from = 'Paris'

*Какие компании организуют перелеты с Владивостока (Vladivostok)?*
SELECT Company.name FROM Trip 
JOIN Company ON Trip.company = Company.id 
WHERE town_from = 'Vladivostok'

*Вывести вылеты, совершенные с 10 ч. по 14 ч. 1 января 1900 г.*
SELECT * FROM Trip 
WHERE time_out BETWEEN '1900-01-01 10:00:00' AND '1900-01-01 14:00:00'

*Вывести пассажиров с самым длинным именем*
SELECT name FROM Passenger ORDER BY LENGTH(name) DESC LIMIT 1

*Вывести id и количество пассажиров для всех прошедших полётов*
SELECT trip, COUNT(passenger) as count 
FROM Pass_in_trip 
GROUP BY trip

*Вывести имена людей, у которых есть полный тёзка среди пассажиров*
SELECT name FROM Passenger 
GROUP BY name HAVING COUNT(name) > 1 

*В какие города летал Bruce Willis*
SELECT town_to FROM Trip 
WHERE id in (
    SELECT trip FROM Pass_in_trip 
    WHERE Passenger in (
        SELECT id FROM Passenger 
        WHERE name = 'Bruce Willis')) 
        
*Во сколько Стив Мартин (Steve Martin) прилетел в Лондон (London)*
SELECT time_in FROM Trip 
JOIN Pass_in_trip ON Trip.id = Pass_in_trip.trip
JOIN Passenger ON Pass_in_trip.passenger = Passenger.id
WHERE Passenger.name = 'Steve Martin' and Trip.town_to = 'London'

*Вывести отсортированный по количеству перелетов (по убыванию) и имени (по возрастанию) список пассажиров, совершивших хотя бы 1 полет.*
SELECT Passenger.name, COUNT(passenger) as count FROM Pass_in_trip 
JOIN Passenger ON Pass_in_trip.passenger = Passenger.id
GROUP BY Passenger
ORDER BY count DESC, name

*Определить, сколько потратил в 2005 году каждый из членов семьи. Поля в результирующей таблице: member_name,status, costs*
SELECT FamilyMembers.member_name, FamilyMembers.status, SUM(Payments.unit_price * Payments.amount) as costs 
FROM Payments JOIN FamilyMembers ON Payments.family_member = FamilyMembers.member_id
WHERE date BETWEEN '2005-01-01 00:00:00' and '2005-12-31 23:23:59'
GROUP BY member_name, status

*Узнать, кто старше всех в семьe*
SELECT member_name FROM FamilyMembers
WHERE birthday = (SELECT MIN(birthday) FROM FamilyMembers)

*Определить, кто из членов семьи покупал картошку (potato)*
SELECT DISTINCT status FROM Payments
JOIN Goods ON Payments.good = Goods.good_id
JOIN FamilyMembers ON Payments.family_member = FamilyMembers.member_id
WHERE good_name = 'potato'

*Сколько и кто из семьи потратил на развлечения (entertainment). Вывести статус в семье, имя, сумму*
SELECT FamilyMembers.status, FamilyMembers.member_name, Payments.unit_price*Payments.amount as costs FROM GoodTypes
JOIN Goods ON GoodTypes.good_type_id = Goods.type
JOIN Payments ON Goods.good_id = Payments.good
JOIN FamilyMembers ON FamilyMembers.member_id = Payments.family_member
WHERE  GoodTypes.good_type_name = 'entertainment'

*Определить товары, которые покупали более 1 раза*
SELECT good_name FROM (
    SELECT good_name, COUNT(good_name) as count FROM Payments 
    JOIN Goods ON Payments.good = Goods.good_id
    GROUP BY good_name) as ct
WHERE ct.count > 1

*Найти имена всех матерей (mother)*
SELECT member_name FROM FamilyMembers WHERE status = 'mother'

*Найдите самый дорогой деликатес (delicacies) и выведите его стоимость*
SELECT good_name, MAX(unit_price) as unit_price FROM Payments 
JOIN Goods ON Payments.good = Goods.good_id
JOIN GoodTypes ON GoodTypes.good_type_id = Goods.type
WHERE good_type_name = 'delicacies'
GROUP BY good_name
ORDER BY unit_price 
DESC LIMIT 1

*Определить кто и сколько потратил в июне 2005. Поля в результирующей таблице: member_name, costs*
SELECT member_name, (unit_price*amount) as costs FROM (
    SELECT * FROM Payments 
    WHERE Payments.date BETWEEN '2005-06-01' AND '2005-06-30' ) as pt
JOIN FamilyMembers ON pt.family_member = FamilyMembers.member_id

*Определить, какие товары не покупались в 2005 году*
SELECT good_name FROM Goods WHERE good_id NOT IN (
    SELECT good FROM Payments
    WHERE YEAR(date) = 2005)
    
*Определить группы товаров, которые не приобретались в 2005 году. Поля в результирующей таблице:good_type_name*
SELECT GoodTypes.good_type_name FROM GoodTypes 
WHERE GoodTypes.good_type_name NOT IN (
    SELECT GoodTypes.good_type_name FROM Payments 
    JOIN Goods ON Payments.good = Goods.good_id
    JOIN GoodTypes ON Goods.type = GoodTypes.good_type_id
    WHERE YEAR(date) = 2005)

*Узнать, сколько потрачено на каждую из групп товаров в 2005 году. Вывести название группы и сумму Поля в результирующей таблице: good_type_name costs*
SELECT good_type_name, SUM((unit_price*amount)) as costs FROM Payments 
JOIN Goods ON Payments.good = Goods.good_id
JOIN GoodTypes ON GoodTypes.good_type_id = Goods.type
WHERE YEAR(date) = 2005
GROUP BY good_type_name

*Сколько рейсов совершили авиакомпании с Ростова (Rostov) в Москву (Moscow) ?*
SELECT COUNT(id) as count FROM Trip WHERE town_from = 'Rostov' AND town_to = 'Moscow'

*Выведите имена пассажиров улетевших в Москву (Moscow) на самолете TU-134*
SELECT DISTINCT  Passenger.name FROM Pass_in_trip 
JOIN Passenger ON Pass_in_trip.passenger=Passenger.id
WHERE trip IN (SELECT id FROM Trip WHERE town_to = 'Moscow' AND plane = 'TU-134')

*Выведите нагруженность (число пассажиров) каждого рейса (trip). Результат вывести в отсортированном виде по убыванию нагруженности.
Поля в результирующей таблице: trip, count*
SELECT trip, COUNT(trip) as count FROM Trip 
JOIN Pass_in_trip ON Pass_in_trip.trip = Trip.id
GROUP BY trip
ORDER BY count DESC 
